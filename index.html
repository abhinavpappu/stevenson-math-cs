<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Stevenson Math and CS</title>
    <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family:"Roboto", "Open Sans", sans-serif;
    }

    .hr {
      height: 1px;
      width: 100%;
      background-color: black;
    }

    .templates, .hide {
      display: none;
    }

    .ripple-enabled {
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .ripple-gray .ripple {
      background-color: gray;
    }

    .ripple {
      background-color: white;
      opacity: .4;
      height: 8px;
      width: 8px;
      border-radius: 6px;
      transition: transform .3s, opacity .3s;
      position: absolute;
    }

    .indigo {background-color: #303f9f}
    .red {background-color: #F44336}
    .purple {background-color: #673AB7}
    .blue {background-color: #1E88E5}
    .teal {background-color: #009688}
    .green {background-color: #43A047}
    .orange {background-color: #F57C00}
    .indigo-text {color: #303f9f}
    .red-text {color: #F44336}
    .purple-text {color: #673AB7}
    .blue-text {color: #1E88E5}
    .teal-text {color: #009688}
    .green-text {color: #43A047}
    .orange-text {color: #F57C00}

    #head {
      padding: 100px;
      cursor: pointer;
    }

    #head .text {
      max-width: 1000px;
      margin: auto;
      font-size: 2.5em;
      letter-spacing: 1.5px;
      color: white;
    }

    #loading-bar {
      position: relative;
      overflow: hidden;
      display: none;
      height: 5px;
      width: 100%;
    }

    #loading-bar .bg, #loading-bar .bar-container, #loading-bar .bar{
      position: absolute;
      height: 100%;
      width: 100%;
    }

    #loading-bar .bg {
      opacity: .5;
    }

    #loading-bar .bar-container.first{
      left: -55%;
    }

    #loading-bar .bar-container.second {
      left: -145%;
    }

    .loading-translate-1 {animation: translate-1 2s infinite linear}
    .loading-translate-2 {animation: translate-2 2s infinite linear}
    .loading-scale-1 {animation: scale-1 2s infinite linear}
    .loading-scale-2 {animation: scale-2 2s infinite linear}

    @keyframes translate-1 {
      0% {
        animation-timing-function: cubic-bezier(.15, 0, .515, .41);
        transform: translateX(0)
      }
      25% {
        animation-timing-function: cubic-bezier(.31, .284, .8, .734);
        transform: translateX(38%)
      }
      48.35% {
        animation-timing-function: cubic-bezier(.4, .627, .6, .902);
        transform: translateX(84%)
      }
      100% {
        transform: translateX(160%)
      }
    }

    @keyframes translate-2 {
      0% {
        transform: translateX(0)
      }
      20% {
        animation-timing-function: cubic-bezier(.5, 0, .702, .496);
        transform: translateX(0)
      }
      59.15% {
        animation-timing-function: cubic-bezier(.302, .381, .55, .956);
        transform: translateX(84%)
      }
      100% {
        transform: translateX(200%)
      }
    }

    @keyframes scale-1 {
      0% {
        animation-timing-function: cubic-bezier(.15, 0, .515, .41);
        transform: scaleX(.08)
      }
      19.15% {
        animation-timing-function: cubic-bezier(.31, .284, .8, .734);
        transform: scaleX(.457)
      }
      44.15% {
        animation-timing-function: cubic-bezier(.4, .627, .6, .902);
        transform: scaleX(.728)
      }
      100% {
        transform: scaleX(.08)
      }
    }

    @keyframes scale-2 {
      0% {
        transform: scaleX(.08)
      }
      36.65% {
        animation-timing-function: cubic-bezier(.335, .125, .785, 1);
        transform: scaleX(.08)
      }
      69.15% {
        animation-timing-function: cubic-bezier(.06, .11, .6, 1);
        transform: scaleX(.661)
      }
      100% {
        transform: scaleX(.08)
      }
    }
    </style>
  </head>

  <body>
    <div class="templates">
      <div class="ripple"></div>
    </div>

    <div id="head">
      <div class="text"></div>
    </div>

    <div id="loading-bar">
      <div class="bg"></div>
      <div class="bar-container first"><div class="bar"></div></div>
      <div class="bar-container second"><div class="bar"></div></div>
    </div>

    <div id="content">
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.min.js"></script>

    <script>
    // NOTE:
    // - When modifiying anything created from a template, make sure only
    // descendents of the page are selected (ex. '.homepage') to prevent
    // unintentional modification of the template itself

    const constants = {
      title: 'Stevenson Math and Computer Science',
      color: 'indigo', // background color of header
      colors: ['orange', 'blue', 'red', 'green', 'purple', 'teal'], // make sure the corresponding CSS classes are added when adding colors
      pages: { // maintains index of all pages on the website
        courses: { // uses coursepage.html to load the following pages
          loader: loadCourse,
          '#/geometry-honors': {
            name: 'Geometry Honors', // the name is used to obtain the corresponding JSON data file (replace spaces with underscores)
          },
          '#/precalc-honors': {
            name: 'Pre-Calc Honors',
          },
          '#/calc-ab': {
            name: 'AP Calculus AB',
          },
          '#/calc-bc': {
            name: 'AP Calculus BC',
          },
          '#/apcsp': {
            name: 'AP Computer Science Principles',
          },
          '#/programming': {
            name: 'Computer Programming',
          }
        }
      },
      animations: { //any durations/delays for animations are stored here for easy modification
        ripple: {
          duration: 300 // the ripple animation on any element with .ripple-enabled lasts for 300 milliseconds
        }
      }
    }

    // initialize course colors
    var i = 0;
    for (var prop in constants.pages.courses) {
      constants.pages.courses[prop].color = constants.colors[i++ % constants.colors.length];
    }

    function slowDownAnimations(amount = 10) { // temporary, for development purposes
      for (var a in constants.animations) {
        for (var b in constants.animations[a]) {
          constants.animations[a][b] *= amount;
        }
      }
    }

    // loads homepage whenever #head is clicked
    $("#head").click(function() {
      location.href = location.origin + location.pathname;
    });

    /**
     * shows or hides the loading bar set to the specified color
     * the color is maintained from any previous color changes
     * Ex. loadingBar(false, 'blue') sets color to blue without displaying loading bar
     *
     * @param  {boolean} show    true - show the loading bar, false - hide the loading bar (does nothing if already shown/hidden)
     * @param  {String} [color]  optionally set the loading bar to one of the colors in constants.colors
     */
    function loadingBar(show, color) {
      if (color) {
        $('#loading-bar .bg').removeClass().addClass('bg'); //remove all classes except bg (remove all previous colors)
        $('#loading-bar .bar').removeClass().addClass('bar'); //remove all classes except bar (remove all previous colors)
        $('#loading-bar .bg, #loading-bar .bar').addClass(color);
      }
      if (show) {
        $('#loading-bar').css('display', 'block');
        $('#loading-bar .bar-container.first').addClass('loading-translate-1');
        $('#loading-bar .bar-container.second').addClass('loading-translate-2');
        $('#loading-bar .first .bar').addClass('loading-scale-1');
        $('#loading-bar .second .bar').addClass('loading-scale-2');
      } else {
        $('#loading-bar .bar-container.first').removeClass('loading-translate-1');
        $('#loading-bar .bar-container.second').removeClass('loading-translate-2');
        $('#loading-bar .first .bar').removeClass('loading-scale-1');
        $('#loading-bar .second .bar').removeClass('loading-scale-2');
        $('#loading-bar').css('display', '');
      }
    }

    // calls the function load when page is ready
    $(function() {
      load();
    });

    // popstate is fired when window's history changes (when back/forward is clicked or when location.href is set)
    // necessary since browser doesn't automatically reload when hash part of url changes
    $(window).on('popstate', function (e) {
      load();
    });


    /**
     * loads a page using the specified page
     * if unspecified, uses URL to determine desired page
     *
     * @param  {String} [page]  the hash portion of the URL of desired page (look at keys defined in constants.pages)
     */
    function load(page) {
      //if page is not specified, sets page to the part of URL after #
      page = page || location.hash;

      //Removes everything in #content and all color classes for header
      $('#content > *').remove();
      $('#head').removeClass();

      var loader = false; //loader is a function that is used to load the proper content for each type of page
      for (prop in constants.pages) {
        if (constants.pages[prop][page]) {
          loader = constants.pages[prop].loader; // sets the loader function to the loader for the requested page
          page = constants.pages[prop][page]; //sets page to the page object so the loader doesn't have to refind it if necessary
        }
      }

      // if the loader for a page isn't found, defaults to loading the home page
      if (!loader) {
        loader = loadHome;
      }
      loader(page, function() {
        // the click listener needs to be attached after page is loaded
        $('.ripple-enabled').click(function(e) {
          // mouse x and y relative to the clicked element instead of the page
          var relX = e.pageX - $(this).offset().left;
          var relY = e.pageY - $(this).offset().top;

          // clones ripple to ensure that a new copy is being used for each click
          var ripple = $(".templates").children(".ripple").clone();

          // adds ripple to clicked element and sets position to click location
          $(this).append(ripple);
          ripple.css({left: relX, top: relY});

          // gets length of twice the diagonal in order for ripple to cover all of the element even if mouse click
          // is in a corner and then divides by ripple's diameter to get appropriate scale amount
          var scaleAmount = Math.sqrt(Math.pow($(this).outerHeight(), 2) + Math.pow($(this).outerWidth(), 2)) * 2 / ripple.width();
          ripple.css({'transform': 'scale(' + scaleAmount + ')', 'opacity': .2});

          // removes ripple after 300 milliseconds
          setTimeout(function() {
            ripple.remove();
          }, constants.animations.ripple.duration);
        });
      });
    }

    /**
     * loads homepage.html into space below header
     *
     * @param  {Object} data          currently unused parameter for loadHome that may be necessary for other loaders
     * @param  {Function} [callback]  calls this function after loading homepage with the status as a parameter
     */
    function loadHome(data, callback) {
      $('#head').addClass(constants.color);
      $('#head .text').text(constants.title);

      loadingBar(true, constants.color);

      // asynchronously loads homepage.html into #content
      $('#content').load('homepage.html', function(_, status) {
        loadingBar(false);
        if (status == 'error') {
          //TODO: show error message
        } else {
          initializeHome();
        }
        if (callback) {
          callback(status);
        }
      })
    }


    /**
     * loads courspage.html with the data of the desired course
     *
     * @param  {Object} course        the data for the desired course to load (use the objects contained in constants.pages.courses)
     * @param  {Function} [callback]  calls this function after loading coursepage with the status as a parameter
     */
    function loadCourse(course, callback) {
      $('#head').addClass(course.color);
      $('#head .text').text(course.name);

      loadingBar(true, course.color);
      // asynchronously loads coursepage.html into #content
      $("#content").load('coursepage.html', function(_, status) {
        if (status == 'error') {
          loadingBar(false);
          //TODO: show error message
          if (callback) callback(status);
        } else {
          //gets the data for the desired course
          $.get('courses/' + course.name.replace(/ /g, '_') + '.json', function(data, status) {
            loadingBar(false);
            if (status == 'error') {
              //TODO: show error message
            } else {
              data.color = course.color;
              data.name = course.name;
              initializeCourse(data);
            }
            if (callback) callback(status);
          });
        }
      });
    }

    function log() { // temporary, for development purposes
      console.log(Array.from(arguments).reduce((str, item) => str + item + ' ', ''));
      if(arguments.length == 1) return arguments[0];
    }
    </script>
  </body>
</html>
